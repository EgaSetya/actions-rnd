name: PR Comment Notification

on:
  issue_comment:
    types: [created, edited, deleted]

jobs:
  notify:
    runs-on: ubuntu-latest
    if: github.event.issue.pull_request
    steps:
      - name: Set Action Type
        id: action
        run: |
          if [ "${{ github.event.action }}" = "created" ]; then
            echo "icon=💬" >> $GITHUB_OUTPUT
            echo "action_text=New" >> $GITHUB_OUTPUT
          elif [ "${{ github.event.action }}" = "edited" ]; then
            echo "icon=✏️" >> $GITHUB_OUTPUT
            echo "action_text=Edited" >> $GITHUB_OUTPUT
          else
            echo "icon=🗑️" >> $GITHUB_OUTPUT
            echo "action_text=Deleted" >> $GITHUB_OUTPUT
          fi

      - name: Send to Google Chat
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d '{
            "cardsV2": [{
              "card": {
                "header": {
                  "title": "${{ steps.action.outputs.action_text }} PR Comment ${{ steps.action.outputs.icon }}",
                  "subtitle": "<${{ github.event.issue.html_url }}|${{ github.event.issue.title }}>"
                },
                "sections": [{
                  "header": "Comment Details",
                  "collapsible": false,
                  "widgets": [{
                    "decoratedText": {
                      "text": "@${{ github.event.comment.user.login }}",
                      "startIcon": {
                        "knownIcon": "PERSON"
                      }
                    }
                  },
                  {
                    "textParagraph": {
                      "text": "${{ github.event.comment.body }}"
                    }
                  }]
                },
                {
                  "widgets": [{
                    "buttonList": {
                      "buttons": [{
                        "text": "View Comment",
                        "onClick": {
                          "openLink": {
                            "url": "${{ github.event.comment.html_url }}"
                          }
                        }
                      }]
                    }
                  }]
                }]
              }
            }]
          }' \
          "${{ vars.GOOGLE_CHAT_WEBHOOK }}"
